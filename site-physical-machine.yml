# Gather facts from all nodes
#
- hosts: all
  tasks:
    - name: setup
      setup:

# Adding Ceph Monitors
#
- name: Deploy Ceph monitors
  hosts: ceph_monitor_servers
  become: yes
  vars_files:
    - ["physical_machine/deployment-vars"]
    - ["physical_machine/host_vars/{{inventory_hostname}}", "vars/empty"]
  roles:
    - {role: ceph, osd: False, mon: True, spdk: False, tags: [ceph-mon]}

# Quorum is required to start defining users and pools (configure ceph).
# The configuration should be done after the Ceph Monitors have been
# deployed and the cluster is up

- name: Configure Ceph cluster
  hosts: ceph_monitor_servers
  become: yes
  vars_files:
    - ["physical_machine/deployment-vars"]
    - ["physical_machine/host_vars/{{inventory_hostname}}", "vars/empty"]
  roles:
    - {role: ceph-bootstrap, tags: [ceph-mon]}

# Storage Nodes Deployment

- name: Configure Ceph OSDs
  hosts: ceph_osd_servers
  become: yes
  vars_files:
    - ["physical_machine/deployment-vars"]
    - ["physical_machine/host_vars/{{inventory_hostname}}", "vars/empty"]
  roles:
    - {role: ceph, osd: True, mon: False, spdk: False, tags: [ceph-osd]}

- name: Configure Ceph OSDs with SPDK 
  hosts: ceph_osd_servers
  become: yes
  vars_files:
    - ["physical_machine/deployment-vars"]
    - ["physical_machine/host_vars/{{inventory_hostname}}", "vars/empty"]
  roles:
    - {role: ceph, osd: False, mon: False, spdk: True, tags: [ceph-spdk-osd]}
